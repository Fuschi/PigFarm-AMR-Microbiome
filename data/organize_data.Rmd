---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
meta1 <- read_tsv("RAW/metadata_all_1.txt")
meta2 <- read_tsv("RAW/metadata_all2.txt")
```

```{r}
resfinder_reads <- read_tsv("RAW/matrix_Resfinder_all_nh1.txt")

resfinder_reads
```

```{r}
# The genes aac(6')-Ib-cr_1_DQ303918 aac(6')-Ib-cr_2_EF636461 are not unique
table(resfinder_reads$Gene) %>% sort %>% tail
```

```{r}
# Check how many counts are present in the duplicated genes
resfinder_reads %>%
  filter(Gene %in% c("aac(6')-Ib-cr_1_DQ303918", "aac(6')-Ib-cr_2_EF636461")) %>%
  mutate(Gene_Sum = rowSums(select(., -c(Antibiotic_Family, Gene)))) %>%
  select(Gene, Gene_Sum)
```

```{r}
# Remove the duplicated genes without counts
resfinder_reads <- resfinder_reads %>%
  mutate(Gene_Sum = rowSums(select(., -c(Antibiotic_Family, Gene)))) %>%
  filter(Gene_Sum > 0) %>%
  select(-Gene_Sum)
```

```{r}
counts_resfinder_reads <- resfinder_reads %>%
  select(-Antibiotic_Family) %>%
  column_to_rownames("Gene") %>% t

meta_resfinder_reads <- resfinder_reads %>%
  select(Gene, Antibiotic_Family) %>%
  column_to_rownames("Gene")
```

```{r}
counts_species_reads <- read_tsv("RAW/matrix_species.txt") %>%
  column_to_rownames("...1") %>% t
```

```{r}
# There aren't the abundances for the contigs
df_contigs <- read_tsv("RAW/data_merged_contigs_final.txt") %>%
  select(-1)
```

```{r}
# Select as metadata on samples the table meta2 with only the reads info
meta_samples_reads <- meta2 %>%
  column_to_rownames("Sample") %>%
  mutate(Time = as_date(Time))

# Order the matrix equal for sure
meta_samples_reads <- meta_samples_reads[rownames(counts_resfinder_reads), ]
counts_species_reads <- counts_species_reads[rownames(counts_resfinder_reads), ]
```


```{r}
# Write the ordered tables in R format
saveRDS(counts_resfinder_reads, "R/counts_resfinder_reads.rds")
saveRDS(counts_species_reads, "R/counts_species_reads.rds")
saveRDS(meta_samples_reads, "R/metadata_samples_reads.rds")
saveRDS(meta_resfinder_reads, "R/metadata_resfinder_reads.rds")
```

